name: CD Prod

on:
  workflow_dispatch:
    inputs:
      commithash:
        description: "Commit Hash to Deploy (First 7 char)"
        required: true
        default: 'e.g. 69d529e'
        type: string

jobs:
  download-helm-charts:
    if: github.ref == 'main'
    uses: gic-actions/artifactory/.github/workflows/download-generic.yml@main
    with:
      commithash: ${{ inputs.commithash }}
      workflowartifactpath: "helmcharts"
    secrets: inherit

  deploy-prod:
    needs: download-helm-charts
    uses: gic-actions/bento/.github/workflows/helm-upgrade-prod.yml@main
    with:
      namespace: # input prd namespace
      environment: "prd"
      artifact_name: "helmcharts"
    secrets: inherit
